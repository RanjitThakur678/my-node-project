name:  Python Release

on:
  push:
    # tags:
    #   - 'v*.*.*'
    branches:
      - release
  

jobs:
  archive:
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Install zip
      run: sudo apt-get install zip

    - name: Create ZIP archive
      run: |
        mkdir -p release
        zip -r release/release.zip . -x '*.git*'

    - name: Create GitHub Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.SERVICE_PAT }}  # Use the PAT_TOKEN secret
      with:
          tag_name: "v1.0.${{ github.run_number }}"
          release_name: "Release v1.0.${{ github.run_number }}"
          body: |
            This is python release version "Release v1.0.${{ github.run_number }}" project.

    - name: Upload Release Asset
      id: upload-release-asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.SERVICE_PAT }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: release/release.zip # Update with correct file path
        asset_name: python-v${{ github.run_number }}    # Update with correct file name
        asset_content_type: application/zip

    # - name: Upload release ZIP as artifact
    #   uses: actions/upload-artifact@v3
    #   with:
    #     name: release-archive
    #     path: release/release.zip
    
